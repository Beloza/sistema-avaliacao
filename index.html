<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema de Avalia√ß√£o</title>
  <style>
/* Reset b√°sico */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right, #f0f2f5, #e3e8ef);
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
  padding-top: 80px;
  color: #333;
  overflow-x: hidden;
}

h1 {
  margin-bottom: 20px;
  text-align: center;
  color: #2c3e50;
}

.container {
  display: grid;
  gap: clamp(8px, 2vw, 24px);
  margin-top: 20px;
  width: 100%;
  height: calc(100vh - 140px);
  max-width: 100vw;
  padding: 0 10px;
  position: relative;
  justify-content: center;
  align-content: center;
  
  /* Grid responsivo baseado no n√∫mero de itens */
  grid-template-columns: repeat(auto-fit, minmax(min(200px, calc(100vw / 6)), 1fr));
  grid-auto-rows: minmax(200px, 1fr);
  
  /* Ajustes espec√≠ficos para diferentes quantidades */
  &:has(.funcionaria:nth-child(5):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(280px, calc(100vw / 4)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(6):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(250px, calc(100vw / 4)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(7):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(220px, calc(100vw / 5)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(8):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(200px, calc(100vw / 5)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(9):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(180px, calc(100vw / 5)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(10):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(170px, calc(100vw / 6)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(11):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(160px, calc(100vw / 6)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(12):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(150px, calc(100vw / 7)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(13):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(140px, calc(100vw / 7)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(14):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(135px, calc(100vw / 8)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(15):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(130px, calc(100vw / 8)), 1fr));
  }
}

/* Fallback para navegadores que n√£o suportam :has() */
@supports not selector(:has(*)) {
  .container {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
  
  /* Classes din√¢micas para controle via JS */
  .container.items-5 { grid-template-columns: repeat(auto-fit, minmax(min(280px, calc(100vw / 4)), 1fr)); }
  .container.items-6 { grid-template-columns: repeat(auto-fit, minmax(min(250px, calc(100vw / 4)), 1fr)); }
  .container.items-7 { grid-template-columns: repeat(auto-fit, minmax(min(220px, calc(100vw / 5)), 1fr)); }
  .container.items-8 { grid-template-columns: repeat(auto-fit, minmax(min(200px, calc(100vw / 5)), 1fr)); }
  .container.items-9 { grid-template-columns: repeat(auto-fit, minmax(min(180px, calc(100vw / 5)), 1fr)); }
  .container.items-10 { grid-template-columns: repeat(auto-fit, minmax(min(170px, calc(100vw / 6)), 1fr)); }
  .container.items-11 { grid-template-columns: repeat(auto-fit, minmax(min(160px, calc(100vw / 6)), 1fr)); }
  .container.items-12 { grid-template-columns: repeat(auto-fit, minmax(min(150px, calc(100vw / 7)), 1fr)); }
  .container.items-13 { grid-template-columns: repeat(auto-fit, minmax(min(140px, calc(100vw / 7)), 1fr)); }
  .container.items-14 { grid-template-columns: repeat(auto-fit, minmax(min(135px, calc(100vw / 8)), 1fr)); }
  .container.items-15 { grid-template-columns: repeat(auto-fit, minmax(min(130px, calc(100vw / 8)), 1fr)); }
}

.funcionaria {
  background-color: #fff;
  border-radius: clamp(8px, 1.5vw, 16px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  padding: clamp(8px, 1.5vw, 16px);
  text-align: center;
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  min-height: 0;
  height: 100%;
}

.funcionaria:hover {
  transform: translateY(-2px);
}

.funcionaria.blurred {
  filter: blur(3px);
  opacity: 0.4;
  transform: scale(0.95);
}

.funcionaria.selected {
  transform: scale(1.05);
  z-index: 10;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.funcionaria img {
  width: 100%;
  flex: 1;
  object-fit: cover;
  border-radius: clamp(6px, 1vw, 12px);
  min-height: 0;
  max-height: calc(100% - 60px);
}

.funcionaria h2 {
  font-size: clamp(10px, 1.8vw, 18px);
  margin: clamp(4px, 1vw, 10px) 0;
  color: #34495e;
  line-height: 1.2;
  flex-shrink: 0;
  height: auto;
  min-height: clamp(20px, 3vw, 40px);
  display: flex;
  align-items: center;
  justify-content: center;
}

.avaliacoes {
  display: none;
  position: absolute;
  right: -10px;
  top: 50%;
  transform: translateY(-50%);
  flex-direction: column;
  gap: clamp(6px, 1vw, 12px);
  z-index: 15;
}

.funcionaria.selected .avaliacoes {
  display: flex;
}

.avaliacoes button {
  padding: clamp(8px, 1.5vw, 15px) clamp(10px, 2vw, 20px);
  border: none;
  border-radius: clamp(6px, 1vw, 12px);
  cursor: pointer;
  background-color: #3498db;
  color: white;
  font-size: clamp(14px, 2.5vw, 24px);
  transition: all 0.2s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  min-width: clamp(40px, 6vw, 80px);
  min-height: clamp(35px, 5vw, 60px);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: clamp(2px, 0.5vw, 4px);
}

.avaliacoes button .emoji {
  font-size: clamp(16px, 2.5vw, 24px);
  line-height: 1;
}

.avaliacoes button .label {
  font-size: clamp(10px, 1.5vw, 14px);
  line-height: 1;
  font-weight: bold;
}

.avaliacoes button:hover {
  background-color: #2980b9;
  transform: scale(1.05);
}

.avaliacoes button:active {
  background-color: #2ecc71;
}

/* Overlay para fechar sele√ß√£o */
.overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.3);
  z-index: 5;
}

.overlay.active {
  display: block;
}

/* Orienta√ß√£o paisagem - ajustes especiais */
@media (orientation: landscape) and (max-height: 600px) {
  body {
    padding-top: 60px;
  }
  
  .container {
    height: calc(100vh - 100px);
    gap: clamp(4px, 1vw, 12px);
  }
  
  .funcionaria {
    padding: clamp(4px, 1vw, 12px);
  }
  
  .funcionaria h2 {
    font-size: clamp(8px, 1.5vw, 14px);
    margin: clamp(2px, 0.5vw, 6px) 0;
    min-height: clamp(16px, 2.5vw, 30px);
  }
  
  .avaliacoes {
    gap: clamp(3px, 0.8vw, 8px);
  }
  
  .avaliacoes button {
    font-size: clamp(12px, 2vw, 18px);
    padding: clamp(4px, 1vw, 10px) clamp(6px, 1.5vw, 12px);
    min-width: clamp(30px, 4vw, 50px);
    min-height: clamp(25px, 4vw, 40px);
    gap: clamp(1px, 0.3vw, 2px);
  }
  
  .avaliacoes button .emoji {
    font-size: clamp(12px, 2vw, 18px);
  }
  
  .avaliacoes button .label {
    font-size: clamp(8px, 1.3vw, 12px);
    font-weight: bold;
  }
}

/* Dispositivos m√≥veis em retrato */
@media (orientation: portrait) and (max-width: 768px) {
  .container {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)) !important;
    gap: clamp(6px, 1.5vw, 12px);
    height: calc(100vh - 120px);
  }
  
  .funcionaria.selected .avaliacoes {
    position: static;
    transform: none;
    margin-top: 8px;
    flex-direction: row;
    justify-content: center;
    gap: 6px;
    right: auto;
    top: auto;
  }
}

/* Telas muito pequenas */
@media (max-width: 480px) {
  .container {
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)) !important;
    gap: clamp(4px, 1vw, 8px);
  }
  
  .funcionaria h2 {
    font-size: clamp(8px, 2vw, 12px);
    min-height: clamp(14px, 2.5vw, 20px);
  }
}

/* Estilos administrativos - N√ÉO MODIFICAR */
.admin-panel {
  display: none;
  margin-top: 30px;
  width: 100%;
  max-width: 800px;
  background-color: #ffffff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.admin-panel.active {
  display: block;
}

.admin-panel h2 {
  margin-bottom: 16px;
  color: #2c3e50;
  text-align: center;
}

input, select {
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-bottom: 12px;
  width: 100%;
}

button {
  font-family: inherit;
  padding: 10px 16px;
  background-color: #34495e;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s ease;
}

button:hover {
  background-color: #2c3e50;
}

.controls {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 20;
}

.controls button {
  padding: 12px 20px;
  background-color: #34495e;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s ease;
  font-weight: bold;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.controls button:hover {
  background-color: #2c3e50;
}

.report-box {
  margin-top: 30px;
  background-color: #fefefe;
  padding: 16px;
  border-radius: 10px;
  border: 1px solid #ccc;
  width: 100%;
  max-width: 800px;
  display: none;
}

.report-box.active {
  display: block;
}

.report-box pre {
  white-space: pre-wrap;
  word-wrap: break-word;
  font-family: 'Courier New', Courier, monospace;
  font-size: 14px;
  color: #2c3e50;
}
  </style>
</head>
<body>
  <div class="controls">
    <button id="botaoModoADM" onclick="alternarModoADM()">ADM</button>
  </div>

  <div class="overlay" id="overlay" onclick="deselecionarFuncionaria()"></div>
  <div class="container" id="funcionariasContainer"></div>

  <div class="admin-panel" id="adminPanel">
    <h2>Painel Administrativo</h2>

    <input type="password" id="senhaAdmInput" placeholder="Senha do Modo ADM" style="display: none;" />

    <h3>Cadastro de Funcion√°ria</h3>
    <input type="text" id="nomeNova" placeholder="Nome da Funcion√°ria" />
    <input type="file" id="fotoNova" accept="image/*" />
    <button onclick="adicionarFuncionaria()">Adicionar Funcion√°ria</button>

    <h3>Excluir Funcion√°ria</h3>
    <select id="listaExclusao"></select>
    <button onclick="excluirFuncionaria()">Excluir Selecionada</button>

    <h3>Editar Funcion√°ria</h3>
    <select id="listaEdicao"></select>
    <button onclick="abrirModalEdicao()">Editar Selecionada</button>

    <h3>Alterar Senha ADM</h3>
    <input type="password" id="novaSenha" placeholder="Nova Senha" />
    <button onclick="alterarSenhaADM()">Alterar Senha</button>

    <h3>Backup e Restaura√ß√£o</h3>
    <button onclick="fazerBackup()">Fazer Backup dos Dados</button>
    <input type="file" id="arquivoRestauro" accept=".json" style="margin-top: 10px;" />
    <button onclick="restaurarBackup()">Restaurar Backup</button>

    <h3>Relat√≥rio</h3>
    <button onclick="gerarRelatorio()">Gerar Relat√≥rio</button>
    <button onclick="exportarXML()">Exportar XML</button>
    <button onclick="limparAvaliacoes()">Limpar Todas as Avalia√ß√µes</button>
    <div class="report-box" id="relatorioBox">
      <pre id="relatorioTexto"></pre>
    </div>
  </div>

  <!-- Modal de Edi√ß√£o -->
  <div id="modalEdicao" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div style="background-color: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 400px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
      <h3 style="margin-bottom: 20px; text-align: center; color: #2c3e50;">Editar Funcion√°ria</h3>
      <input type="text" id="nomeEdicao" placeholder="Nome da Funcion√°ria" style="width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 6px;" />
      <input type="file" id="fotoEdicao" accept="image/*" style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 6px;" />
      <div style="display: flex; gap: 10px; justify-content: center;">
        <button onclick="salvarEdicao()" style="padding: 10px 20px; background-color: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer;">Salvar</button>
        <button onclick="fecharModalEdicao()" style="padding: 10px 20px; background-color: #e74c3c; color: white; border: none; border-radius: 6px; cursor: pointer;">Cancelar</button>
      </div>
    </div>
  </div>

  <script>
let funcionarias = JSON.parse(localStorage.getItem('funcionarias')) || [];
let avaliacoes = JSON.parse(localStorage.getItem('avaliacoes')) || {};
let modoADM = false;
let funcionariaSelecionada = null;

// Fun√ß√£o para obter a senha atual
function obterSenhaAtual() {
  return localStorage.getItem('senhaADM') || '1234';
}

function salvarDados() {
  localStorage.setItem('funcionarias', JSON.stringify(funcionarias));
  localStorage.setItem('avaliacoes', JSON.stringify(avaliacoes));
}

function renderizarFuncionarias() {
  const container = document.getElementById('funcionariasContainer');
  container.innerHTML = '';
  
  // Adicionar classe para fallback de navegadores que n√£o suportam :has()
  container.className = 'container';
  if (funcionarias.length <= 15) {
    container.classList.add(`items-${funcionarias.length}`);
  }
  
  funcionarias.forEach((f, i) => {
    const div = document.createElement('div');
    div.className = 'funcionaria';
    div.onclick = () => selecionarFuncionaria(i);
    div.innerHTML = `
      <img src="${f.foto}" alt="${f.nome}">
      <h2>${f.nome}</h2>
      <div class="avaliacoes">
        <button onclick="avaliar(${i}, 'Boa', event)">
          <span class="emoji">üòä</span>
          <span class="label">Excelente</span>
        </button>
        <button onclick="avaliar(${i}, 'Neutra', event)">
          <span class="emoji">üòê</span>
          <span class="label">Boa</span>
        </button>
        <button onclick="avaliar(${i}, 'Ruim', event)">
          <span class="emoji">üòû</span>
          <span class="label">Ruim</span>
        </button>
      </div>
    `;
    container.appendChild(div);
  });
  atualizarListaExclusao();
}

function selecionarFuncionaria(index) {
  if (modoADM) return; // bloqueia sele√ß√£o no modo ADM
  
  // Se j√° est√° selecionada, desseleciona
  if (funcionariaSelecionada === index) {
    deselecionarFuncionaria();
    return;
  }
  
  funcionariaSelecionada = index;
  const funcionariasDivs = document.querySelectorAll('.funcionaria');
  const overlay = document.getElementById('overlay');
  
  funcionariasDivs.forEach((div, i) => {
    if (i === index) {
      div.classList.add('selected');
      div.classList.remove('blurred');
    } else {
      div.classList.add('blurred');
      div.classList.remove('selected');
    }
  });
  
  overlay.classList.add('active');
}

function deselecionarFuncionaria() {
  funcionariaSelecionada = null;
  const funcionariasDivs = document.querySelectorAll('.funcionaria');
  const overlay = document.getElementById('overlay');
  
  funcionariasDivs.forEach(div => {
    div.classList.remove('selected', 'blurred');
  });
  
  overlay.classList.remove('active');
}

function avaliar(index, tipo, event) {
  if (modoADM) return; // bloqueia avalia√ß√£o no modo ADM
  
  // Impede que o clique no bot√£o selecione a funcion√°ria
  if (event) {
    event.stopPropagation();
  }
  
  const nome = funcionarias[index].nome;
  avaliacoes[nome] = avaliacoes[nome] || [];
  avaliacoes[nome].push(tipo);
  salvarDados();
  piscarBotao(index, tipo);
  
  // Desseleciona ap√≥s avaliar
  setTimeout(() => {
    deselecionarFuncionaria();
  }, 500);
}

function piscarBotao(index, tipo) {
  const div = document.getElementsByClassName('funcionaria')[index];
  const botoes = div.querySelectorAll('button');
  botoes.forEach((btn) => {
    const emoji = btn.querySelector('.emoji');
    if (emoji && (
        (emoji.textContent.includes('üòä') && tipo === 'Boa') ||
        (emoji.textContent.includes('üòê') && tipo === 'Neutra') ||
        (emoji.textContent.includes('üòû') && tipo === 'Ruim')
    )) {
      btn.style.backgroundColor = '#2ecc71';
      setTimeout(() => {
        btn.style.backgroundColor = '';
      }, 300);
    }
  });
}

function alternarModoADM() {
  const botao = document.getElementById('botaoModoADM');
  
  if (!modoADM) {
    // Tentando entrar no modo ADM
    const senhaDigitada = prompt('Digite a senha do modo ADM:');
    
    if (senhaDigitada === obterSenhaAtual()) {
      modoADM = true;
      document.getElementById('adminPanel').classList.add('active');
      botao.textContent = 'SAIR ADM';
      botao.style.backgroundColor = '#e74c3c';
      deselecionarFuncionaria(); // Garante que nenhuma funcion√°ria esteja selecionada
      atualizarListaEdicao();
    } else {
      alert('Senha incorreta!');
    }
  } else {
    // Saindo do modo ADM
    modoADM = false;
    document.getElementById('adminPanel').classList.remove('active');
    document.getElementById('relatorioBox').classList.remove('active');
    botao.textContent = 'ADM';
    botao.style.backgroundColor = '#34495e';
  }
}

function adicionarFuncionaria() {
  const nome = document.getElementById('nomeNova').value.trim();
  const fotoInput = document.getElementById('fotoNova');
  
  if (!nome || !fotoInput.files[0]) {
    alert('Nome e foto s√£o obrigat√≥rios!');
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    funcionarias.push({ nome, foto: reader.result });
    salvarDados();
    renderizarFuncionarias();
    document.getElementById('nomeNova').value = '';
    fotoInput.value = '';
    alert('Funcion√°ria adicionada com sucesso!');
  };
  reader.readAsDataURL(fotoInput.files[0]);
}

function excluirFuncionaria() {
  const select = document.getElementById('listaExclusao');
  const nomeSelecionado = select.value;
  
  if (!nomeSelecionado) {
    alert('Selecione uma funcion√°ria para excluir.');
    return;
  }
  
  if (!confirm(`Tem certeza que deseja excluir ${nomeSelecionado}?`)) return;

  funcionarias = funcionarias.filter(f => f.nome !== nomeSelecionado);
  delete avaliacoes[nomeSelecionado];
  salvarDados();
  renderizarFuncionarias();
  alert('Funcion√°ria exclu√≠da com sucesso!');
}

function atualizarListaExclusao() {
  const select = document.getElementById('listaExclusao');
  select.innerHTML = '<option value="">Selecione uma funcion√°ria</option>';
  funcionarias.forEach(f => {
    const option = document.createElement('option');
    option.value = f.nome;
    option.textContent = f.nome;
    select.appendChild(option);
  });
}

function atualizarListaEdicao() {
  const select = document.getElementById('listaEdicao');
  select.innerHTML = '<option value="">Selecione uma funcion√°ria</option>';
  funcionarias.forEach(f => {
    const option = document.createElement('option');
    option.value = f.nome;
    option.textContent = f.nome;
    select.appendChild(option);
  });
}

let funcionariaEditandoIndex = -1;

function abrirModalEdicao() {
  const select = document.getElementById('listaEdicao');
  const nomeSelecionado = select.value;
  
  if (!nomeSelecionado) {
    alert('Selecione uma funcion√°ria para editar.');
    return;
  }
  
  funcionariaEditandoIndex = funcionarias.findIndex(f => f.nome === nomeSelecionado);
  if (funcionariaEditandoIndex === -1) return;
  
  const funcionaria = funcionarias[funcionariaEditandoIndex];
  document.getElementById('nomeEdicao').value = funcionaria.nome;
  document.getElementById('modalEdicao').style.display = 'flex';
}

function fecharModalEdicao() {
  document.getElementById('modalEdicao').style.display = 'none';
  document.getElementById('nomeEdicao').value = '';
  document.getElementById('fotoEdicao').value = '';
  funcionariaEditandoIndex = -1;
}

function salvarEdicao() {
  if (funcionariaEditandoIndex === -1) return;
  
  const novoNome = document.getElementById('nomeEdicao').value.trim();
  const fotoInput = document.getElementById('fotoEdicao');
  
  if (!novoNome) {
    alert('Nome √© obrigat√≥rio!');
    return;
  }
  
  const funcionaria = funcionarias[funcionariaEditandoIndex];
  const nomeAntigo = funcionaria.nome;
  
  // Atualizar nome
  funcionaria.nome = novoNome;
  
  // Atualizar foto se uma nova foi selecionada
  if (fotoInput.files[0]) {
    const reader = new FileReader();
    reader.onload = () => {
      funcionaria.foto = reader.result;
      finalizarEdicao(nomeAntigo, novoNome);
    };
    reader.readAsDataURL(fotoInput.files[0]);
  } else {
    finalizarEdicao(nomeAntigo, novoNome);
  }
}

function finalizarEdicao(nomeAntigo, novoNome) {
  // Atualizar avalia√ß√µes se o nome mudou
  if (nomeAntigo !== novoNome && avaliacoes[nomeAntigo]) {
    avaliacoes[novoNome] = avaliacoes[nomeAntigo];
    delete avaliacoes[nomeAntigo];
  }
  
  salvarDados();
  renderizarFuncionarias();
  fecharModalEdicao();
  alert('Funcion√°ria editada com sucesso!');
}

function gerarRelatorio() {
  let relatorio = 'RELAT√ìRIO DE AVALIA√á√ïES\n';
  relatorio += '========================\n\n';
  
  if (Object.keys(avaliacoes).length === 0) {
    relatorio += 'Nenhuma avalia√ß√£o registrada.';
  } else {
    Object.entries(avaliacoes).forEach(([nome, lista]) => {
      const contagem = { Boa: 0, Neutra: 0, Ruim: 0 };
      lista.forEach(v => contagem[v]++);
      const total = lista.length;
      
      relatorio += `${nome}:\n`;
      relatorio += `  üòä Excelentes: ${contagem.Boa} (${((contagem.Boa/total)*100).toFixed(1)}%)\n`;
      relatorio += `  üòê Boas: ${contagem.Neutra} (${((contagem.Neutra/total)*100).toFixed(1)}%)\n`;
      relatorio += `  üòû Ruins: ${contagem.Ruim} (${((contagem.Ruim/total)*100).toFixed(1)}%)\n`;
      relatorio += `  Total de avalia√ß√µes: ${total}\n\n`;
    });
  }

  document.getElementById('relatorioTexto').textContent = relatorio;
  document.getElementById('relatorioBox').classList.add('active');
}

function exportarXML() {
  let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
  xml += '<sistema_avaliacao>\n';
  xml += '  <funcionarias>\n';
  
  funcionarias.forEach(f => {
    xml += `    <funcionaria>\n`;
    xml += `      <nome>${f.nome}</nome>\n`;
    xml += `      <foto>${f.foto}</foto>\n`;
    xml += `    </funcionaria>\n`;
  });
  
  xml += '  </funcionarias>\n';
  xml += '  <avaliacoes>\n';
  
  Object.entries(avaliacoes).forEach(([nome, lista]) => {
    xml += `    <funcionaria_avaliacoes nome="${nome}">\n`;
    lista.forEach(avaliacao => {
      xml += `      <avaliacao>${avaliacao}</avaliacao>\n`;
    });
    xml += `    </funcionaria_avaliacoes>\n`;
  });
  
  xml += '  </avaliacoes>\n';
  xml += '</sistema_avaliacao>';

  const blob = new Blob([xml], { type: 'application/xml' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `sistema_avaliacao_${new Date().toISOString().split('T')[0]}.xml`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
  
  alert('XML exportado com sucesso!');
}

function limparAvaliacoes() {
  if (!confirm("Deseja realmente limpar TODAS as avalia√ß√µes?")) return;
  avaliacoes = {};
  salvarDados();
  alert('Todas as avalia√ß√µes foram removidas.');
  if (document.getElementById('relatorioBox').classList.contains('active')) {
    gerarRelatorio();
  }
}

function alterarSenhaADM() {
  const novaSenha = document.getElementById('novaSenha').value.trim();
  if (!novaSenha) {
    alert("Digite uma nova senha v√°lida.");
    return;
  }
  localStorage.setItem('senhaADM', novaSenha);
  alert("Senha alterada com sucesso!");
  document.getElementById('novaSenha').value = '';
}

// Fun√ß√µes de Backup e Restaura√ß√£o
function fazerBackup() {
  try {
    // Criar objeto com todos os dados do sistema
    const dadosBackup = {
      funcionarias: funcionarias,
      avaliacoes: avaliacoes,
      senhaADM: localStorage.getItem('senhaADM') || '1234',
      dataBackup: new Date().toISOString(),
      versao: '1.8'
    };

    // Converter para JSON
    const jsonString = JSON.stringify(dadosBackup, null, 2);
    
    // Criar blob e fazer download
    const blob = new Blob([jsonString], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    // Criar link tempor√°rio para download
    const link = document.createElement('a');
    link.href = url;
    link.download = `backup_sistema_avaliacao_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Limpar URL tempor√°ria
    URL.revokeObjectURL(url);
    
    alert('Backup realizado com sucesso! O arquivo foi baixado.');
  } catch (error) {
    console.error('Erro ao fazer backup:', error);
    alert('Erro ao fazer backup. Verifique o console para mais detalhes.');
  }
}

function restaurarBackup() {
  const arquivoInput = document.getElementById('arquivoRestauro');
  const arquivo = arquivoInput.files[0];
  
  if (!arquivo) {
    alert('Por favor, selecione um arquivo de backup.');
    return;
  }
  
  if (!arquivo.name.endsWith('.json')) {
    alert('Por favor, selecione um arquivo JSON v√°lido.');
    return;
  }
  
  // Confirmar restaura√ß√£o
  if (!confirm('ATEN√á√ÉO: Esta a√ß√£o ir√° substituir todos os dados atuais do sistema. Deseja continuar?')) {
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const dadosBackup = JSON.parse(e.target.result);
      
      // Validar estrutura do backup
      if (!dadosBackup.funcionarias || !dadosBackup.avaliacoes) {
        throw new Error('Arquivo de backup inv√°lido: estrutura incorreta.');
      }
      
      // Validar se as funcion√°rias t√™m a estrutura correta
      if (!Array.isArray(dadosBackup.funcionarias)) {
        throw new Error('Arquivo de backup inv√°lido: dados de funcion√°rias corrompidos.');
      }
      
      for (let funcionaria of dadosBackup.funcionarias) {
        if (!funcionaria.nome || !funcionaria.foto) {
          throw new Error('Arquivo de backup inv√°lido: dados de funcion√°ria incompletos.');
        }
      }
      
      // Validar avalia√ß√µes
      if (typeof dadosBackup.avaliacoes !== 'object') {
        throw new Error('Arquivo de backup inv√°lido: dados de avalia√ß√µes corrompidos.');
      }
      
      // Restaurar dados
      funcionarias = dadosBackup.funcionarias;
      avaliacoes = dadosBackup.avaliacoes;
      
      // Restaurar senha ADM se existir no backup
      if (dadosBackup.senhaADM) {
        localStorage.setItem('senhaADM', dadosBackup.senhaADM);
      }
      
      // Salvar no localStorage
      salvarDados();
      
      // Atualizar interface
      renderizarFuncionarias();
      
      // Limpar input de arquivo
      arquivoInput.value = '';
      
      // Mostrar informa√ß√µes do backup restaurado
      const dataBackup = dadosBackup.dataBackup ? new Date(dadosBackup.dataBackup).toLocaleString('pt-BR') : 'N√£o informada';
      const versaoBackup = dadosBackup.versao || 'N√£o informada';
      
      alert(`Backup restaurado com sucesso!\n\nDetalhes do backup:\n- Data: ${dataBackup}\n- Vers√£o: ${versaoBackup}\n- Funcion√°rias: ${funcionarias.length}\n- Total de avalia√ß√µes: ${Object.values(avaliacoes).reduce((total, lista) => total + lista.length, 0)}`);
      
    } catch (error) {
      console.error('Erro ao restaurar backup:', error);
      alert(`Erro ao restaurar backup: ${error.message}`);
    }
  };
  
  reader.onerror = function() {
    alert('Erro ao ler o arquivo de backup.');
  };
  
  reader.readAsText(arquivo);
}

// Inicializa√ß√£o
renderizarFuncionarias();
  </script>
</body>
</html>

