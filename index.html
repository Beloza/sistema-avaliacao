<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema de Avalia√ß√£o</title>
  <style>
/* Reset b√°sico */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right, #f0f2f5, #e3e8ef);
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
  padding-top: 80px;
  color: #333;
}

h1 {
  margin-bottom: 20px;
  text-align: center;
  color: #2c3e50;
}

.container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 24px;
  margin-top: 20px;
  width: 100%;
  max-width: 1200px;
  position: relative;
}

.funcionaria {
  background-color: #fff;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  padding: 16px;
  text-align: center;
  width: 220px;
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
}

.funcionaria:hover {
  transform: translateY(-5px);
}

.funcionaria.blurred {
  filter: blur(3px);
  opacity: 0.4;
  transform: scale(0.9);
}

.funcionaria.selected {
  transform: scale(1.2);
  z-index: 10;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.funcionaria img {
  width: 100%;
  height: 220px;
  object-fit: cover;
  border-radius: 12px;
}

.funcionaria h2 {
  font-size: 18px;
  margin: 10px 0;
  color: #34495e;
}

.avaliacoes {
  display: none;
  position: absolute;
  right: -120px;
  top: 50%;
  transform: translateY(-50%);
  flex-direction: column;
  gap: 12px;
  z-index: 15;
}

.funcionaria.selected .avaliacoes {
  display: flex;
}

.avaliacoes button {
  padding: 15px 20px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  background-color: #3498db;
  color: white;
  font-size: 24px;
  transition: all 0.2s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  min-width: 80px;
  min-height: 60px;
}

.avaliacoes button:hover {
  background-color: #2980b9;
  transform: scale(1.05);
}

.avaliacoes button:active {
  background-color: #2ecc71;
}

/* Overlay para fechar sele√ß√£o */
.overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.3);
  z-index: 5;
}

.overlay.active {
  display: block;
}

/* Responsividade para dispositivos m√≥veis */
@media (max-width: 768px) {
  .container {
    gap: 8px;
    padding: 0 10px;
    max-width: 100%;
    justify-content: space-evenly;
  }
  
  .funcionaria {
    width: calc(50% - 8px);
    max-width: 150px;
    padding: 8px;
  }
  
  .funcionaria img {
    height: 120px;
  }
  
  .funcionaria h2 {
    font-size: 14px;
    margin: 6px 0;
  }
  
  .funcionaria.selected {
    transform: scale(1.05);
  }
  
  .avaliacoes {
    position: static;
    transform: none;
    margin-top: 8px;
    flex-direction: row;
    justify-content: center;
    gap: 6px;
  }
  
  .avaliacoes button {
    min-width: 40px;
    min-height: 40px;
    font-size: 16px;
    padding: 8px;
  }
}

/* Para telas muito pequenas (smartphones pequenos) */
@media (max-width: 480px) {
  .funcionaria {
    width: calc(33.33% - 6px);
    max-width: 110px;
    padding: 6px;
  }
  
  .funcionaria img {
    height: 90px;
  }
  
  .funcionaria h2 {
    font-size: 12px;
    margin: 4px 0;
  }
  
  .avaliacoes button {
    min-width: 35px;
    min-height: 35px;
    font-size: 14px;
    padding: 6px;
  }
}

.admin-panel {
  display: none;
  margin-top: 30px;
  width: 100%;
  max-width: 800px;
  background-color: #ffffff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.admin-panel.active {
  display: block;
}

.admin-panel h2 {
  margin-bottom: 16px;
  color: #2c3e50;
  text-align: center;
}

input, select {
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-bottom: 12px;
  width: 100%;
}

button {
  font-family: inherit;
  padding: 10px 16px;
  background-color: #34495e;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s ease;
}

button:hover {
  background-color: #2c3e50;
}

.controls {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 20;
}

.controls button {
  padding: 12px 20px;
  background-color: #34495e;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s ease;
  font-weight: bold;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.controls button:hover {
  background-color: #2c3e50;
}

.report-box {
  margin-top: 30px;
  background-color: #fefefe;
  padding: 16px;
  border-radius: 10px;
  border: 1px solid #ccc;
  width: 100%;
  max-width: 800px;
  display: none;
}

.report-box.active {
  display: block;
}

.report-box pre {
  white-space: pre-wrap;
  word-wrap: break-word;
  font-family: 'Courier New', Courier, monospace;
  font-size: 14px;
  color: #2c3e50;
}
  </style>
</head>
<body>
  <div class="controls">
    <button id="botaoModoADM" onclick="alternarModoADM()">ADM</button>
  </div>

  <div class="overlay" id="overlay" onclick="deselecionarFuncionaria()"></div>
  <div class="container" id="funcionariasContainer"></div>

  <div class="admin-panel" id="adminPanel">
    <h2>Painel Administrativo</h2>

    <input type="password" id="senhaAdmInput" placeholder="Senha do Modo ADM" style="display: none;" />

    <h3>Cadastro de Funcion√°ria</h3>
    <input type="text" id="nomeNova" placeholder="Nome da Funcion√°ria" />
    <input type="file" id="fotoNova" accept="image/*" />
    <button onclick="adicionarFuncionaria()">Adicionar Funcion√°ria</button>

    <h3>Excluir Funcion√°ria</h3>
    <select id="listaExclusao"></select>
    <button onclick="excluirFuncionaria()">Excluir Selecionada</button>

    <h3>Alterar Senha ADM</h3>
    <input type="password" id="novaSenha" placeholder="Nova Senha" />
    <button onclick="alterarSenhaADM()">Alterar Senha</button>

    <h3>Relat√≥rio</h3>
    <button onclick="gerarRelatorio()">Gerar Relat√≥rio</button>
    <button onclick="exportarXML()">Exportar XML</button>
    <button onclick="limparAvaliacoes()">Limpar Todas as Avalia√ß√µes</button>
    <div class="report-box" id="relatorioBox">
      <pre id="relatorioTexto"></pre>
    </div>
  </div>

  <script>
let funcionarias = JSON.parse(localStorage.getItem('funcionarias')) || [];
let avaliacoes = JSON.parse(localStorage.getItem('avaliacoes')) || {};
let modoADM = false;
let senhaADM = localStorage.getItem('senhaADM') || 'admin123';
let funcionariaSelecionada = null;

function salvarDados() {
  localStorage.setItem('funcionarias', JSON.stringify(funcionarias));
  localStorage.setItem('avaliacoes', JSON.stringify(avaliacoes));
}

function renderizarFuncionarias() {
  const container = document.getElementById('funcionariasContainer');
  container.innerHTML = '';
  funcionarias.forEach((f, i) => {
    const div = document.createElement('div');
    div.className = 'funcionaria';
    div.onclick = () => selecionarFuncionaria(i);
    div.innerHTML = `
      <img src="${f.foto}" alt="${f.nome}">
      <h2>${f.nome}</h2>
      <div class="avaliacoes">
        <button onclick="avaliar(${i}, 'Boa', event)">üòä</button>
        <button onclick="avaliar(${i}, 'Neutra', event)">üòê</button>
        <button onclick="avaliar(${i}, 'Ruim', event)">üòû</button>
      </div>
    `;
    container.appendChild(div);
  });
  atualizarListaExclusao();
}

function selecionarFuncionaria(index) {
  if (modoADM) return; // bloqueia sele√ß√£o no modo ADM
  
  // Se j√° est√° selecionada, desseleciona
  if (funcionariaSelecionada === index) {
    deselecionarFuncionaria();
    return;
  }
  
  funcionariaSelecionada = index;
  const funcionariasDivs = document.querySelectorAll('.funcionaria');
  const overlay = document.getElementById('overlay');
  
  funcionariasDivs.forEach((div, i) => {
    if (i === index) {
      div.classList.add('selected');
      div.classList.remove('blurred');
    } else {
      div.classList.add('blurred');
      div.classList.remove('selected');
    }
  });
  
  overlay.classList.add('active');
}

function deselecionarFuncionaria() {
  funcionariaSelecionada = null;
  const funcionariasDivs = document.querySelectorAll('.funcionaria');
  const overlay = document.getElementById('overlay');
  
  funcionariasDivs.forEach(div => {
    div.classList.remove('selected', 'blurred');
  });
  
  overlay.classList.remove('active');
}

function avaliar(index, tipo, event) {
  if (modoADM) return; // bloqueia avalia√ß√£o no modo ADM
  
  // Impede que o clique no bot√£o selecione a funcion√°ria
  if (event) {
    event.stopPropagation();
  }
  
  const nome = funcionarias[index].nome;
  avaliacoes[nome] = avaliacoes[nome] || [];
  avaliacoes[nome].push(tipo);
  salvarDados();
  piscarBotao(index, tipo);
  
  // Desseleciona ap√≥s avaliar
  setTimeout(() => {
    deselecionarFuncionaria();
  }, 500);
}

function piscarBotao(index, tipo) {
  const div = document.getElementsByClassName('funcionaria')[index];
  const botoes = div.querySelectorAll('button');
  botoes.forEach((btn) => {
    if (btn.innerText.includes('üòä') && tipo === 'Boa' ||
        btn.innerText.includes('üòê') && tipo === 'Neutra' ||
        btn.innerText.includes('üòû') && tipo === 'Ruim') {
      btn.style.backgroundColor = '#2ecc71';
      setTimeout(() => {
        btn.style.backgroundColor = '';
      }, 300);
    }
  });
}

function alternarModoADM() {
  const botao = document.getElementById('botaoModoADM');
  
  if (!modoADM) {
    // Tentando entrar no modo ADM
    const senha = prompt('Digite a senha do modo ADM:');
    
    // Debug - para verificar as senhas (voc√™ pode remover depois)
    console.log('Senha digitada:', senha);
    console.log('Senha esperada:', senhaADM);
    
    if (senha && senha.trim() === senhaADM) {
      modoADM = true;
      document.getElementById('adminPanel').classList.add('active');
      botao.textContent = 'Sair do Modo ADM';
    } else if (senha !== null) { // s√≥ mostra erro se n√£o cancelou
      alert('Senha incorreta!');
    }
  } else {
    // Saindo do modo ADM
    modoADM = false;
    document.getElementById('adminPanel').classList.remove('active');
    document.getElementById('relatorioBox').classList.remove('active');
    botao.textContent = 'Entrar no Modo ADM';
  }
}

function adicionarFuncionaria() {
  const nome = document.getElementById('nomeNova').value.trim();
  const fotoInput = document.getElementById('fotoNova');
  if (!nome || !fotoInput.files[0]) {
    alert('Nome e foto s√£o obrigat√≥rios!');
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    funcionarias.push({ nome, foto: reader.result });
    salvarDados();
    renderizarFuncionarias();
    document.getElementById('nomeNova').value = '';
    fotoInput.value = '';
  };
  reader.readAsDataURL(fotoInput.files[0]);
}

function excluirFuncionaria() {
  const select = document.getElementById('listaExclusao');
  const nomeSelecionado = select.value;
  if (!nomeSelecionado) return;
  if (!confirm(`Tem certeza que deseja excluir ${nomeSelecionado}?`)) return;

  funcionarias = funcionarias.filter(f => f.nome !== nomeSelecionado);
  delete avaliacoes[nomeSelecionado];
  salvarDados();
  renderizarFuncionarias();
}

function atualizarListaExclusao() {
  const select = document.getElementById('listaExclusao');
  select.innerHTML = '';
  funcionarias.forEach(f => {
    const option = document.createElement('option');
    option.value = f.nome;
    option.textContent = f.nome;
    select.appendChild(option);
  });
}

function gerarRelatorio() {
  const relatorio = Object.entries(avaliacoes).map(([nome, lista]) => {
    const contagem = { Boa: 0, Neutra: 0, Ruim: 0 };
    lista.forEach(v => contagem[v]++);
    return `${nome}:\n  üòä Boas: ${contagem.Boa}\n  üòê Neutras: ${contagem.Neutra}\n  üòû Ruins: ${contagem.Ruim}\n`;
  }).join('\n') || 'Nenhuma avalia√ß√£o registrada.';

  document.getElementById('relatorioTexto').textContent = relatorio;
  document.getElementById('relatorioBox').classList.add('active');
}

function exportarXML() {
  let xmlContent = '<?xml version="1.0" encoding="UTF-8"?>\n<avaliacoes>\n';
  
  // Para cada funcion√°ria, criar um registro
  funcionarias.forEach(funcionaria => {
    const nome = funcionaria.nome;
    const avaliacoesFuncionaria = avaliacoes[nome] || [];
    
    xmlContent += `  <funcionaria>\n`;
    xmlContent += `    <nome>${nome}</nome>\n`;
    
    // Adicionar cada avalia√ß√£o como um elemento separado
    avaliacoesFuncionaria.forEach((avaliacao, index) => {
      xmlContent += `    <avaliacao${index + 1}>${avaliacao}</avaliacao${index + 1}>\n`;
    });
    
    // Adicionar contagem total de cada tipo
    const contagem = { Boa: 0, Neutra: 0, Ruim: 0 };
    avaliacoesFuncionaria.forEach(v => contagem[v]++);
    
    xmlContent += `    <total_boas>${contagem.Boa}</total_boas>\n`;
    xmlContent += `    <total_neutras>${contagem.Neutra}</total_neutras>\n`;
    xmlContent += `    <total_ruins>${contagem.Ruim}</total_ruins>\n`;
    xmlContent += `    <total_avaliacoes>${avaliacoesFuncionaria.length}</total_avaliacoes>\n`;
    xmlContent += `  </funcionaria>\n`;
  });
  
  xmlContent += '</avaliacoes>';
  
  // Criar e baixar o arquivo
  const blob = new Blob([xmlContent], { type: 'application/xml' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `avaliacoes_funcionarias_${new Date().toISOString().split('T')[0]}.xml`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  alert('Arquivo XML exportado com sucesso!');
}

function limparAvaliacoes() {
  if (!confirm("Deseja realmente limpar TODAS as avalia√ß√µes?")) return;
  avaliacoes = {};
  salvarDados();
  gerarRelatorio();
}

function alterarSenhaADM() {
  const novaSenha = document.getElementById('novaSenha').value.trim();
  if (!novaSenha) return alert("Digite uma nova senha v√°lida.");
  senhaADM = novaSenha;
  localStorage.setItem('senhaADM', senhaADM);
  alert("Senha alterada com sucesso!");
  document.getElementById('novaSenha').value = '';
}

// Fun√ß√£o para resetar senha (para debug/emerg√™ncia)
function resetarSenha() {
  localStorage.removeItem('senhaADM');
  senhaADM = 'admin123';
  alert('Senha resetada para: admin123');
}

// Para debug - voc√™ pode chamar no console do navegador se necess√°rio
window.resetarSenha = resetarSenha;
window.verificarSenha = () => console.log('Senha atual:', senhaADM);

// Inicializa√ß√£o
renderizarFuncionarias();
  </script>
</body>
</html>
