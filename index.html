<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema de Avaliação</title>
  <style>
/* Reset básico */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right, #f0f2f5, #e3e8ef);
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
  padding-top: 80px;
  color: #333;
  overflow-x: hidden;
}

h1 {
  margin-bottom: 20px;
  text-align: center;
  color: #2c3e50;
}

.container {
  display: grid;
  gap: clamp(8px, 2vw, 24px);
  margin-top: 20px;
  width: 100%;
  height: calc(100vh - 140px);
  max-width: 100vw;
  padding: 0 10px;
  position: relative;
  justify-content: center;
  align-content: center;
  
  /* Grid responsivo baseado no número de itens */
  grid-template-columns: repeat(auto-fit, minmax(min(200px, calc(100vw / 6)), 1fr));
  grid-auto-rows: minmax(200px, 1fr);
  
  /* Ajustes específicos para diferentes quantidades */
  &:has(.funcionaria:nth-child(5):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(280px, calc(100vw / 4)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(6):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(250px, calc(100vw / 4)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(7):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(220px, calc(100vw / 5)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(8):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(200px, calc(100vw / 5)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(9):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(180px, calc(100vw / 5)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(10):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(170px, calc(100vw / 6)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(11):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(160px, calc(100vw / 6)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(12):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(150px, calc(100vw / 7)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(13):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(140px, calc(100vw / 7)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(14):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(135px, calc(100vw / 8)), 1fr));
  }
  
  &:has(.funcionaria:nth-child(15):last-child) {
    grid-template-columns: repeat(auto-fit, minmax(min(130px, calc(100vw / 8)), 1fr));
  }
}

/* Fallback para navegadores que não suportam :has() */
@supports not selector(:has(*)) {
  .container {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
  
  /* Classes dinâmicas para controle via JS */
  .container.items-5 { grid-template-columns: repeat(auto-fit, minmax(min(280px, calc(100vw / 4)), 1fr)); }
  .container.items-6 { grid-template-columns: repeat(auto-fit, minmax(min(250px, calc(100vw / 4)), 1fr)); }
  .container.items-7 { grid-template-columns: repeat(auto-fit, minmax(min(220px, calc(100vw / 5)), 1fr)); }
  .container.items-8 { grid-template-columns: repeat(auto-fit, minmax(min(200px, calc(100vw / 5)), 1fr)); }
  .container.items-9 { grid-template-columns: repeat(auto-fit, minmax(min(180px, calc(100vw / 5)), 1fr)); }
  .container.items-10 { grid-template-columns: repeat(auto-fit, minmax(min(170px, calc(100vw / 6)), 1fr)); }
  .container.items-11 { grid-template-columns: repeat(auto-fit, minmax(min(160px, calc(100vw / 6)), 1fr)); }
  .container.items-12 { grid-template-columns: repeat(auto-fit, minmax(min(150px, calc(100vw / 7)), 1fr)); }
  .container.items-13 { grid-template-columns: repeat(auto-fit, minmax(min(140px, calc(100vw / 7)), 1fr)); }
  .container.items-14 { grid-template-columns: repeat(auto-fit, minmax(min(135px, calc(100vw / 8)), 1fr)); }
  .container.items-15 { grid-template-columns: repeat(auto-fit, minmax(min(130px, calc(100vw / 8)), 1fr)); }
}

.funcionaria {
  background-color: #fff;
  border-radius: clamp(8px, 1.5vw, 16px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  padding: clamp(8px, 1.5vw, 16px);
  text-align: center;
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  min-height: 0;
  height: 100%;
}

.funcionaria:hover {
  transform: translateY(-2px);
}

.funcionaria.blurred {
  filter: blur(3px);
  opacity: 0.4;
  transform: scale(0.95);
}

.funcionaria.selected {
  transform: scale(1.05);
  z-index: 10;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.funcionaria img {
  width: 100%;
  flex: 1;
  object-fit: cover;
  border-radius: clamp(6px, 1vw, 12px);
  min-height: 0;
  max-height: calc(100% - 60px);
}

.funcionaria h2 {
  font-size: clamp(10px, 1.8vw, 18px);
  margin: clamp(4px, 1vw, 10px) 0;
  color: #34495e;
  line-height: 1.2;
  flex-shrink: 0;
  height: auto;
  min-height: clamp(20px, 3vw, 40px);
  display: flex;
  align-items: center;
  justify-content: center;
}

.avaliacoes {
  display: none;
  position: absolute;
  right: -10px;
  top: 50%;
  transform: translateY(-50%);
  flex-direction: column;
  gap: clamp(6px, 1vw, 12px);
  z-index: 15;
}

.funcionaria.selected .avaliacoes {
  display: flex;
}

.avaliacoes button {
  padding: clamp(8px, 1.5vw, 15px) clamp(10px, 2vw, 20px);
  border: none;
  border-radius: clamp(6px, 1vw, 12px);
  cursor: pointer;
  background-color: #3498db;
  color: white;
  font-size: clamp(14px, 2.5vw, 24px);
  transition: all 0.2s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  min-width: clamp(40px, 6vw, 80px);
  min-height: clamp(35px, 5vw, 60px);
}

.avaliacoes button:hover {
  background-color: #2980b9;
  transform: scale(1.05);
}

.avaliacoes button:active {
  background-color: #2ecc71;
}

/* Overlay para fechar seleção */
.overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.3);
  z-index: 5;
}

.overlay.active {
  display: block;
}

/* Orientação paisagem - ajustes especiais */
@media (orientation: landscape) and (max-height: 600px) {
  body {
    padding-top: 60px;
  }
  
  .container {
    height: calc(100vh - 100px);
    gap: clamp(4px, 1vw, 12px);
  }
  
  .funcionaria {
    padding: clamp(4px, 1vw, 12px);
  }
  
  .funcionaria h2 {
    font-size: clamp(8px, 1.5vw, 14px);
    margin: clamp(2px, 0.5vw, 6px) 0;
    min-height: clamp(16px, 2.5vw, 30px);
  }
  
  .avaliacoes {
    gap: clamp(3px, 0.8vw, 8px);
  }
  
  .avaliacoes button {
    font-size: clamp(12px, 2vw, 18px);
    padding: clamp(4px, 1vw, 10px) clamp(6px, 1.5vw, 12px);
    min-width: clamp(30px, 4vw, 50px);
    min-height: clamp(25px, 4vw, 40px);
  }
}

/* Dispositivos móveis em retrato */
@media (orientation: portrait) and (max-width: 768px) {
  .container {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)) !important;
    gap: clamp(6px, 1.5vw, 12px);
    height: calc(100vh - 120px);
  }
  
  .funcionaria.selected .avaliacoes {
    position: static;
    transform: none;
    margin-top: 8px;
    flex-direction: row;
    justify-content: center;
    gap: 6px;
    right: auto;
    top: auto;
  }
}

/* Telas muito pequenas */
@media (max-width: 480px) {
  .container {
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)) !important;
    gap: clamp(4px, 1vw, 8px);
  }
  
  .funcionaria h2 {
    font-size: clamp(8px, 2vw, 12px);
    min-height: clamp(14px, 2.5vw, 20px);
  }
}

/* Estilos administrativos - NÃO MODIFICAR */
.admin-panel {
  display: none;
  margin-top: 30px;
  width: 100%;
  max-width: 800px;
  background-color: #ffffff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.admin-panel.active {
  display: block;
}

.admin-panel h2 {
  margin-bottom: 16px;
  color: #2c3e50;
  text-align: center;
}

input, select {
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-bottom: 12px;
  width: 100%;
}

button {
  font-family: inherit;
  padding: 10px 16px;
  background-color: #34495e;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s ease;
}

button:hover {
  background-color: #2c3e50;
}

.controls {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 20;
}

.controls button {
  padding: 12px 20px;
  background-color: #34495e;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s ease;
  font-weight: bold;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.controls button:hover {
  background-color: #2c3e50;
}

.report-box {
  margin-top: 30px;
  background-color: #fefefe;
  padding: 16px;
  border-radius: 10px;
  border: 1px solid #ccc;
  width: 100%;
  max-width: 800px;
  display: none;
}

.report-box.active {
  display: block;
}

.report-box pre {
  white-space: pre-wrap;
  word-wrap: break-word;
  font-family: 'Courier New', Courier, monospace;
  font-size: 14px;
  color: #2c3e50;
}
  </style>
</head>
<body>
  <div class="controls">
    <button id="botaoModoADM" onclick="alternarModoADM()">ADM</button>
  </div>

  <div class="overlay" id="overlay" onclick="deselecionarFuncionaria()"></div>
  <div class="container" id="funcionariasContainer"></div>

  <div class="admin-panel" id="adminPanel">
    <h2>Painel Administrativo</h2>

    <input type="password" id="senhaAdmInput" placeholder="Senha do Modo ADM" style="display: none;" />

    <h3>Cadastro de Funcionária</h3>
    <input type="text" id="nomeNova" placeholder="Nome da Funcionária" />
    <input type="file" id="fotoNova" accept="image/*" />
    <button onclick="adicionarFuncionaria()">Adicionar Funcionária</button>

    <h3>Excluir Funcionária</h3>
    <select id="listaExclusao"></select>
    <button onclick="excluirFuncionaria()">Excluir Selecionada</button>

    <h3>Alterar Senha ADM</h3>
    <input type="password" id="novaSenha" placeholder="Nova Senha" />
    <button onclick="alterarSenhaADM()">Alterar Senha</button>

    <h3>Relatório</h3>
    <button onclick="gerarRelatorio()">Gerar Relatório</button>
    <button onclick="exportarXML()">Exportar XML</button>
    <button onclick="limparAvaliacoes()">Limpar Todas as Avaliações</button>
    <div class="report-box" id="relatorioBox">
      <pre id="relatorioTexto"></pre>
    </div>
  </div>

  <script>
let funcionarias = JSON.parse(localStorage.getItem('funcionarias')) || [];
let avaliacoes = JSON.parse(localStorage.getItem('avaliacoes')) || {};
let modoADM = false;
let funcionariaSelecionada = null;

// Função para obter a senha atual
function obterSenhaAtual() {
  return localStorage.getItem('senhaADM') || '1234';
}

function salvarDados() {
  localStorage.setItem('funcionarias', JSON.stringify(funcionarias));
  localStorage.setItem('avaliacoes', JSON.stringify(avaliacoes));
}

function renderizarFuncionarias() {
  const container = document.getElementById('funcionariasContainer');
  container.innerHTML = '';
  
  // Adicionar classe para fallback de navegadores que não suportam :has()
  container.className = 'container';
  if (funcionarias.length <= 15) {
    container.classList.add(`items-${funcionarias.length}`);
  }
  
  funcionarias.forEach((f, i) => {
    const div = document.createElement('div');
    div.className = 'funcionaria';
    div.onclick = () => selecionarFuncionaria(i);
    div.innerHTML = `
      <img src="${f.foto}" alt="${f.nome}">
      <h2>${f.nome}</h2>
      <div class="avaliacoes">
        <button onclick="avaliar(${i}, 'Boa', event)">😊</button>
        <button onclick="avaliar(${i}, 'Neutra', event)">😐</button>
        <button onclick="avaliar(${i}, 'Ruim', event)">😞</button>
      </div>
    `;
    container.appendChild(div);
  });
  atualizarListaExclusao();
}

function selecionarFuncionaria(index) {
  if (modoADM) return; // bloqueia seleção no modo ADM
  
  // Se já está selecionada, desseleciona
  if (funcionariaSelecionada === index) {
    deselecionarFuncionaria();
    return;
  }
  
  funcionariaSelecionada = index;
  const funcionariasDivs = document.querySelectorAll('.funcionaria');
  const overlay = document.getElementById('overlay');
  
  funcionariasDivs.forEach((div, i) => {
    if (i === index) {
      div.classList.add('selected');
      div.classList.remove('blurred');
    } else {
      div.classList.add('blurred');
      div.classList.remove('selected');
    }
  });
  
  overlay.classList.add('active');
}

function deselecionarFuncionaria() {
  funcionariaSelecionada = null;
  const funcionariasDivs = document.querySelectorAll('.funcionaria');
  const overlay = document.getElementById('overlay');
  
  funcionariasDivs.forEach(div => {
    div.classList.remove('selected', 'blurred');
  });
  
  overlay.classList.remove('active');
}

function avaliar(index, tipo, event) {
  if (modoADM) return; // bloqueia avaliação no modo ADM
  
  // Impede que o clique no botão selecione a funcionária
  if (event) {
    event.stopPropagation();
  }
  
  const nome = funcionarias[index].nome;
  avaliacoes[nome] = avaliacoes[nome] || [];
  avaliacoes[nome].push(tipo);
  salvarDados();
  piscarBotao(index, tipo);
  
  // Desseleciona após avaliar
  setTimeout(() => {
    deselecionarFuncionaria();
  }, 500);
}

function piscarBotao(index, tipo) {
  const div = document.getElementsByClassName('funcionaria')[index];
  const botoes = div.querySelectorAll('button');
  botoes.forEach((btn) => {
    if (btn.innerText.includes('😊') && tipo === 'Boa' ||
        btn.innerText.includes('😐') && tipo === 'Neutra' ||
        btn.innerText.includes('😞') && tipo === 'Ruim') {
      btn.style.backgroundColor = '#2ecc71';
      setTimeout(() => {
        btn.style.backgroundColor = '';
      }, 300);
    }
  });
}

function alternarModoADM() {
  const botao = document.getElementById('botaoModoADM');
  
  if (!modoADM) {
    // Tentando entrar no modo ADM
    const senhaDigitada = prompt('Digite a senha do modo ADM:');
    
    if (senhaDigitada === null) {
      return; // Usuário cancelou
    }
    
    const senhaCorreta = obterSenhaAtual();
    
    // Debug detalhado
    console.log('=== DEBUG SENHA ===');
    console.log('Senha digitada:', `"${senhaDigitada}"`);
    console.log('Senha esperada:', `"${senhaCorreta}"`);
    console.log('Tipos:', typeof senhaDigitada, typeof senhaCorreta);
    console.log('Iguais?:', senhaDigitada === senhaCorreta);
    console.log('==================');
    
    // Comparação simples e direta
    if (senhaDigitada === senhaCorreta) {
      modoADM = true;
      document.getElementById('adminPanel').classList.add('active');
      botao.textContent = 'Sair do Modo ADM';
      alert('Acesso liberado ao modo ADM!');
    } else {
      alert(`Senha incorreta!\nVocê digitou: "${senhaDigitada}"\nSenha esperada: "${senhaCorreta}"`);
    }
  } else {
    // Saindo do modo ADM
    modoADM = false;
    document.getElementById('adminPanel').classList.remove('active');
    document.getElementById('relatorioBox').classList.remove('active');
    botao.textContent = 'ADM';
  }
}

function adicionarFuncionaria() {
  const nome = document.getElementById('nomeNova').value.trim();
  const fotoInput = document.getElementById('fotoNova');
  if (!nome || !fotoInput.files[0]) {
    alert('Nome e foto são obrigatórios!');
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    funcionarias.push({ nome, foto: reader.result });
    salvarDados();
    renderizarFuncionarias();
    document.getElementById('nomeNova').value = '';
    fotoInput.value = '';
  };
  reader.readAsDataURL(fotoInput.files[0]);
}

function excluirFuncionaria() {
  const select = document.getElementById('listaExclusao');
  const nomeSelecionado = select.value;
  if (!nomeSelecionado) return;
  if (!confirm(`Tem certeza que deseja excluir ${nomeSelecionado}?`)) return;

  funcionarias = funcionarias.filter(f => f.nome !== nomeSelecionado);
  delete avaliacoes[nomeSelecionado];
  salvarDados();
  renderizarFuncionarias();
}

function atualizarListaExclusao() {
  const select = document.getElementById('listaExclusao');
  select.innerHTML = '';
  funcionarias.forEach(f => {
    const option = document.createElement('option');
    option.value = f.nome;
    option.textContent = f.nome;
    select.appendChild(option);
  });
}

function gerarRelatorio() {
  const relatorio = Object.entries(avaliacoes).map(([nome, lista]) => {
    const contagem = { Boa: 0, Neutra: 0, Ruim: 0 };
    lista.forEach(v => contagem[v]++);
    return `${nome}:\n  😊 Boas: ${contagem.Boa}\n  😐 Neutras: ${contagem.Neutra}\n  😞 Ruins: ${contagem.Ruim}\n`;
  }).join('\n') || 'Nenhuma avaliação registrada.';

  document.getElementById('relatorioTexto').textContent = relatorio;
  document.getElementById('relatorioBox').classList.add('active');
}

function exportarXML() {
  let xmlContent = '<?xml version="1.0" encoding="UTF-8"?>\n<avaliacoes>\n';
  
  // Para cada funcionária, criar um registro
  funcionarias.forEach(funcionaria => {
    const nome = funcionaria.nome;
    const avaliacoesFuncionaria = avaliacoes[nome] || [];
    
    xmlContent += `  <funcionaria>\n`;
    xmlContent += `    <nome>${nome}</nome>\n`;
    
    // Adicionar cada avaliação como um elemento separado
    avaliacoesFuncionaria.forEach((avaliacao, index) => {
      xmlContent += `    <avaliacao${index + 1}>${avaliacao}</avaliacao${index + 1}>\n`;
    });
    
    // Adicionar contagem total de cada tipo
    const contagem = { Boa: 0, Neutra: 0, Ruim: 0 };
    avaliacoesFuncionaria.forEach(v => contagem[v]++);
    
    xmlContent += `    <total_boas>${contagem.Boa}</total_boas>\n`;
    xmlContent += `    <total_neutras>${contagem.Neutra}</total_neutras>\n`;
    xmlContent += `    <total_ruins>${contagem.Ruim}</total_ruins>\n`;
    xmlContent += `    <total_avaliacoes>${avaliacoesFuncionaria.length}</total_avaliacoes>\n`;
    xmlContent += `  </funcionaria>\n`;
  });
  
  xmlContent += '</avaliacoes>';
  
  // Criar e baixar o arquivo
  const blob = new Blob([xmlContent], { type: 'application/xml' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `avaliacoes_funcionarias_${new Date().toISOString().split('T')[0]}.xml`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  alert('Arquivo XML exportado com sucesso!');
}

function limparAvaliacoes() {
  if (!confirm("Deseja realmente limpar TODAS as avaliações?")) return;
  avaliacoes = {};
  salvarDados();
  gerarRelatorio();
}

function alterarSenhaADM() {
  const novaSenha = document.getElementById('novaSenha').value;
  if (!novaSenha) {
    alert("Digite uma nova senha válida.");
    return;
  }
  
  // Salvar no localStorage
  localStorage.setItem('senhaADM', novaSenha);
  
  alert(`Senha alterada com sucesso!\nNova senha: "${novaSenha}"`);
  console.log('Nova senha salva:', novaSenha);
  document.getElementById('novaSenha').value = '';
}

// Função para resetar senha (para debug/emergência)
function resetarSenha() {
  localStorage.removeItem('senhaADM');
  alert('Senha resetada para: 1234');
  console.log('Senha resetada para padrão: 1234');
}

// Para debug - você pode chamar no console do navegador se necessário
window.resetarSenha = resetarSenha;
window.verificarSenha = () => {
  const senhaAtual = obterSenhaAtual();
  console.log('Senha atual:', `"${senhaAtual}"`);
  alert(`Senha atual: "${senhaAtual}"`);
  return senhaAtual;
};
window.limparSenha = () => {
  localStorage.removeItem('senhaADM');
  console.log('Senha removida do localStorage. Senha padrão: 1234');
  alert('Senha removida! Agora a senha é: 1234');
};
window.definirSenha = (novaSenha) => {
  localStorage.setItem('senhaADM', novaSenha);
  console.log('Senha definida para:', novaSenha);
  alert(`Senha definida para: "${novaSenha}"`);
};

// Inicialização
renderizarFuncionarias();
  </script>
</body>
</html>
